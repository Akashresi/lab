# Phase 1: Repository Audit & Problem Identification

## 1. Codebase Analysis
- **Architecture**: Monorepo structure.
  - Root: Backend dependencies & orchestration.
  - `/client`: Vite + React 19 Frontend.
  - `/server`: Node.js + Express + Sequelize Backend.
- **Database**: PostgreSQL with Sequelize ORM.
- **AI Integration**: Google Gemini (via `utils/aiHelper.js`) with mock fallback.
- **Real-time**: Socket.io initialized.

## 2. Problem Checklist

### ❌ Critical Issues (Must Fix)
1.  **Security - Role Escalation**:
    -   `POST /api/auth/register` accepts `role` in the request body, allowing anyone to register as `admin` or `creator`.
    -   **Fix**: Enforce default `participant` role. Only Admins should promote users.
2.  **Security - Code Execution**:
    -   `utils/codeExecutor.js` executes code directly on the host machine using `spawn`.
    -   **Risk**: High (RCE).
    -   **Fix**: Sandbox Required (Docker or Piston API). For this scope, strictly warn/limit.
3.  **Missing Implementation**:
    -   `exportQuizResults` (QuizController) is `501 Not Implemented`.
    -   **Migrations**: No Sequelize migrations folder. Relies on `sequelize.sync()`, which is risky for production schema updates.
4.  **AI Reliability**:
    -   `callAI` fallback is `null`, which causes simple string matching in `quizController`. Needs consistent JSON schema enforcement.

### ❌ Incomplete / Broken
-   **Middleware**: `authMiddleware.js` relies solely on decoded token payload for role checks, not verifying against current DB state (Risk if user deleted/demoted).
-   **Sandbox**: No real isolation for code challenges.

### ✅ Functional Components
-   Basic Quiz CRUD.
-   Basic Authentication (Login/Register).
-   Sequelize Models defined correctly.

## 3. Plan of Action (Next Steps)
1.  **Phase 2**: Secure Authentication.
    -   Fix `authController` registration.
    -   Harden `authMiddleware`.
2.  **Phase 3**: Upgrade Quiz System.
    -   Implement Export.
    -   Validate AI generation.
3.  **Phase 4**: Sandbox Safety (Best Effort).
4.  **Phase 7**: Database Stability (Migrations).

---
*Report Generated by Antigravity*
